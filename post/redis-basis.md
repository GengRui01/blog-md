---
title: "Redis知识点整理"
tags: ["Redis", "Interview"]
date: 2019-12-30
---

Redis本质上是一个Key-Value类型的内存数据库，其相关知识点整理

<!--more-->

## 什么是Redis

Redis本质上是一个Key-Value类型的内存数据库，很像memcached，整个数据库统统加载在内存当中进行操作，定期通过异步操作把数据库数据flush到硬盘上进行保存。

- 优点：
    - 因为是纯内存操作，Redis的性能非常出色，每秒可以处理超过 10万次读写操作，是已知性能最快的Key-Value DB。
    - Redis的出色之处不仅仅是性能，Redis最大的魅力是支持保存多种数据结构，此外单个value的最大限制是1GB，不像 memcached只能保存1MB的数据，因此Redis可以用来实现很多有用的功能，比方说用他的List来做FIFO双向链表，实现一个轻量级的高性 能消息队列服务，用他的Set可以做高性能的tag系统等等。
    - 另外Redis也可以对存入的Key-Value设置expire时间，因此也可以被当作一 个功能加强版的memcached来用。
- 缺点：数据库容量受到物理内存的限制，不能用作海量数据的高性能读写，因此Redis适合的场景主要局限在较小数据量的高性能操作和运算上。

## Redis和memcached的区别

- memcached所有的值均是简单的字符串，redis则支持更为丰富的数据类型
- redis的速度比memcached快很多
- redis可以持久化其数据

## Redis支持哪几种数据类型

String、List、Set、Sorted Set、hashes

## 为什么是单线程的

采用单线程避免了不必要的上下文切换，也不存在多进程、多线程切换消耗CPU，不存在加锁释放锁，更没有死锁等消耗性能。

## Redis线程模型

Redis内部使用file event handler文件事件处理器，它是单线程的，采用IO多路复用机制同时监听多个socket，根据socket上的事件来选择对应事件处理器处理。

IO多路复用机制中“多路”是指多个网络连接，“复用”是指复用同一个线程。此机制可以让单个线程高效的处理多个连接请求。

Redis特殊的线程模型再加上Redis在内存中操作数据的速度非常快造就了Redis具有很高的吞吐量，可以高并发。

## 持久化方式

- RDB快照（某个时间点的一次全量数据备份）
    - 触发机制：save命令手动触发 & 根据配置文件中触发规则自动执行
    - 优点：
        - 文件小，适合定时备份，用于灾难恢复
        - 加载速度快，直接恢复数据不需要跑命令
    - 缺点：
        - 无法做到实时持久化，会丢失上次备份之后的数据
- AOF日志（连续的增量备份）
    - 开启方式：默认是关闭的，通过redis.conf配置文件进行开启
    - 重写机制：采用类似RDB快照的方式全量遍历内存中数据，然后逐个序列到新的AOF文件中，新的变更操作一并追加到后面，然后用新文件替换老文件。
    - 触发机制：bgrewriteaof命令手动触发 & 根据配置文件参数确定自动触发时机
    - 优点：
        - 只是追加写日志文件，对服务器性能影响较小，速度更快，消耗内存较少
    - 缺点：
        - 文件太大，需要不断重写瘦身，即使瘦身后也是文本文件，比RDB文件（二进制文件）体积大
        - AOF重演命令式恢复数据，速度比RDB快照慢
- 混合持久化
    - 大量数据使用RDB快照方式，性能高，恢复时间快
    - 增量数据使用AOF日志方式，保证数据不丢失